{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/mutableHandlers.ts", "../src/reactive.ts", "../src/apiWatch.ts", "../src/computed.ts"],
  "sourcesContent": ["export function isObject(value) {\n  return value !== null && typeof value === \"object\"\n}\nexport function isFunction(value) {\n  return typeof value ==='function'\n}", "export let activeEffect = null\nlet targetMap = new Map()\n\nfunction cleanupEffect(effect) {\n  let { deps } = effect\n  for (let i = 0; i < deps.length; i++) {\n    deps[i].delete(effect)\n  }\n  effect.deps.length = 0\n}\nexport class ReactiveEffect {\n  // private fn\n  constructor(private fn, public scheduler?) {\n    this.fn = fn\n  }\n  parent = undefined\n  active = true\n  deps = []\n  run() {\n    if (!this.active) {\n      return this.fn()//\u4E0D\u4F1A\u89E6\u53D1\u6536\u96C6   \n    }\n    try {\n      this.parent = activeEffect\n      activeEffect = this\n      cleanupEffect(activeEffect)\n      return this.fn()//\u4F1A\u89E6\u53D1\u6536\u96C6\n    } finally {\n      activeEffect = this.parent\n      this.parent = undefined\n    }\n  }\n  stop() {\n    if (this.active) {\n      this.active = false\n      cleanupEffect(this)\n    }\n  }\n}\nexport function effect(fn, options: any = {}) {\n  const _effect = new ReactiveEffect(fn, options.scheduler)\n  _effect.run()\n  const runner = _effect.run.bind(_effect)\n  //\u53EF\u4EE5\u901A\u8FC7runner\u62FF\u5230effect\u4E2D\u7684\u6240\u6709\u5C5E\u6027\n  runner.effect = _effect\n  return runner\n}\n\nexport function trackEffect(depSet) {\n  let shouldTrack = !depSet.has(activeEffect)\n  if (shouldTrack) {\n    depSet.add(activeEffect)\n    activeEffect.deps.push(depSet)\n  }\n}\n\nexport function track(target, key) {\n  if (activeEffect) {\n    let depsMap = targetMap.get(target)\n    if (!depsMap) {\n      targetMap.set(target, depsMap = new Map())\n    }\n    let depSet = depsMap.get(key)\n    if (!depSet) {\n      depsMap.set(key, depSet = new Set())\n    }\n    trackEffect(depSet)\n  }\n}\n\nexport function triggerEffect(depSet) {\n  let depSetCopy = [...depSet]\n  depSetCopy.forEach((effect) => {\n    if (effect !== activeEffect) {\n      if (effect.scheduler) {\n        effect.scheduler()\n      } else {\n        effect.run()\n      }\n    }\n  })\n}\nexport function trigger(target, key) {\n  let depsMap = targetMap.get(target)\n  if (!depsMap) return;\n  let depSet = depsMap.get(key)\n  if (!depSet) return;\n  triggerEffect(depSet)\n}", "import { ReactiveFlags, reactive } from './reactive'\nimport { track, trigger } from './effect'\nimport { isObject } from '@vue/shared'\nexport const mutableHandler = {\n  get(target, key, receiver) {\n    console.log(key,6)\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      console.log(target,7)\n      return true\n    }\n    if (isObject(target[key])) {\n      return reactive(target[key])\n    }\n    track(target, key)\n    return Reflect.get(target, key, receiver)\n  },\n  set(target, key, value, receiver) {\n    let oldValue = target[key]\n    let r = Reflect.set(target, key, value, receiver)\n    if (oldValue !== value) {\n      trigger(target, key)\n    }\n    return r\n  }\n}\n\n", "import { isObject } from \"@vue/shared\";\nimport { mutableHandler } from './mutableHandlers'\n// export import { watch } from './apiWatch.ts'\nexport const enum ReactiveFlags {\n  IS_REACTIVE = '_v_isReactive'\n}\nconst reactiveMap = new WeakMap()\n\nexport function reactive(target) {\n  if (!isObject(target)) return target\n\n  let existingProxy = reactiveMap.get(target)\n  if (existingProxy) return existingProxy //\u5982\u679C\u88AB\u4EE3\u7406\u8FC7\u8FD4\u56DE\n\n  if (target[ReactiveFlags.IS_REACTIVE]) {//\u5982\u679C\u662Fstate\u76F4\u63A5\u8FD4\u56DEstate\n    // 1\uFF09vue3.0\u7684\u65F6\u5019\uFF0C\u4F1A\u521B\u9020\u4E00\u4E2A\u53CD\u54CD\u6620\u5C04\uFF0C\u4EE3\u7406\u7684\u7ED3\u679C\uFF0C\u5BF9\u5E94\u539F\u5185\u5BB9\n    // 2\uFF09\u76EE\u524D\u4E0D\u7528\u521B\u5EFA\u53CD\u5411\u6620\u5C04\u8868\uFF0C\u7528\u7684\u65B9\u5F0F\u662F\uFF0C\u5982\u679C\u8FD9\u4E2A\u5BF9\u8C61\u88AB\u4EE3\u7406\u8FC7\u4E86\uFF0C\u5DF2\u7ECF\u88AB\u62E6\u622A\u8FC7\u4E86\n    return target\n  }\n\n\n  const proxy = new Proxy(target, mutableHandler)\n\n  reactiveMap.set(target, proxy)\n\n  return proxy\n}\n\nexport function isReactive(targer) {\n  return targer[ReactiveFlags.IS_REACTIVE]\n}\n", "// watch api \u7528\u6CD5\u5F88\u591A\uFF0C\u5E38\u89C1\u7684\u5199\u6CD5\u5C31\u662F\u76D1\u63A7\u4E00\u4E2A\u51FD\u6570\u7684\u8FD4\u56DE\u503C\uFF0C\u6839\u636E\u8FD4\u56DE\u503C\u7684\u53D8\u5316\u89E6\u53D1\u5BF9\u5E94\u7684\u51FD\u6570\n\nimport { isFunction, isObject } from \"@vue/shared\";\nimport { ReactiveEffect } from \"./effect\";\nimport { isReactive } from \"./reactive\";\n\nfunction traverse(value, seen = new Set()) {\n  if (!isObject(value)) {\n    return value\n  }\n  if (seen.has(value)) {\n    return value\n  }\n  seen.add(value)\n  for (const key in value) {\n    traverse(value[key], seen)\n  }\n  return value\n}\n\n\n\n\nexport function watch(source, cb, options) {\n  return dowwatch(source, cb, options)\n}\n\nexport function watchEffect(source, options) {\n  return dowwatch(source, null, options)\n}\n\n// watch\u53EF\u4EE5\u4F20\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u76D1\u63A7\u5BF9\u8C61\u7684\u53D8\u5316\nexport function dowwatch(source, cb, options: any = {}) {\n  // 1)source\u662F\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\n  // 2\uFF09source\u662F\u4E00\u4E2A\u51FD\u6570\n  let getter;\n  if (isReactive(source)) {\n    getter = () => traverse(source)\n  } else if (isFunction(source)) {\n    // effect+scheduler\n    getter = source\n  }\n  let oldValue;\n\n  let clear;\n  function onCleanUP(fn){\n    clear = fn\n  }\n  const job = () => {\n    if (cb) {\n      if(clear){//\u6267\u884C\u7684\u65F6\u5019\uFF0C\u628A\u4E0A\u6B21\u7684\u6E05\u7406\u51FD\u6570\u6267\u884C\n        clear()\n      }\n      const newValue = effect.run()\n      cb(newValue, oldValue,onCleanUP);\n      oldValue = newValue\n    } else {\n      effect.run()\n    }\n  }\n  const effect = new ReactiveEffect(getter, job)\n  oldValue = effect.run();\n  // console.log(oldValue,39)\n  // effect(getter,{scheduler:cb}) \n}", "import { isFunction } from \"@vue/shared\";\nimport { ReactiveEffect, activeEffect, trackEffect, triggerEffect } from \"./effect\";\n\nclass ComputedRefImpl {\n  public effect;\n  public _value;\n  public _dirty = true;\n  public dep = new Set()\n  constructor(getter, public setter) {\n    this.effect = new ReactiveEffect(getter, () => {\n      // console.log(123123)\n      if (!this._dirty) {\n        this._dirty = true\n        triggerEffect(this.dep)\n        // \u5F53\u4F9D\u8D56\u53D1\u751F\u53D8\u5316\uFF0C\u8BA1\u7B97\u5C5E\u6027\u7684effect\u9700\u8981\u89E6\u53D1\u66F4\u65B0\n      }\n    })\n  }\n  get value() {\n    // \u5728\u53D6\u503C\u7684\u65F6\u5019\uFF0C\u8981\u5BF9\u8BA1\u7B97\u5C5E\u6027\u505A\u4F9D\u8D56\u6536\u96C6\n    //\u5982\u679C\u8BA1\u7B97\u5C5E\u6027\u662F\u5728effect\u4E2D\u4F7F\u7528\u7684\u8981\u505A\u4F9D\u8D56\u6536\u96C6\n    // if(activeEffect){\n    trackEffect(this.dep)\n    // }\n    if (this._dirty) {\n      this._dirty = false\n      this._value = this.effect.run()//this._value\u5C31\u662F\u53D6\u503C\u540E\u7684\u7ED3\u679C\n    }\n    return this._value\n  }\n  set value(newVal) {\n    this.setter(newVal)\n  }\n}\n\nexport function computed(getterOrOptions) {\n  let getter;\n  let setter;\n  console.log(getterOrOptions, 6)\n  const isGetter = isFunction(getterOrOptions)\n  if (isGetter) {\n    getter = getterOrOptions\n    setter = () => {\n      console.log('warn')\n    }\n  } else {\n    getter = getterOrOptions.get\n    setter = getterOrOptions.set\n  }\n  return new ComputedRefImpl(getter, setter)\n} "],
  "mappings": "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",
  "names": []
}
